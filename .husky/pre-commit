#!/bin/bash

# Run jsdoc2md to generate the documentation
# jsdoc2md *.js > docs/API.md

# Check if any .js files are among the staged changes
# git diff --cached --name-only lists staged (index) files
if git diff --cached --name-only | grep -q '\.js$'; then
  echo "JavaScript source files detected in staged changes. Regenerating API documentation..."
  
  # Run the JSDoc generation script
  # Ensure you are running this from the project root, or adjust the path to the script
  node scripts/jsdoc-to-md.js

  # Stage the generated documentation files for commit
  # This ensures the generated docs are always committed alongside their source changes
  git add docs/api/
  echo "API documentation regenerated and staged."
else
  echo "No JavaScript source files changed. Skipping API documentation regeneration."
fi

# Run clasp
clasp push

# IMPORTANT: Always exit with 0 for a successful hook, 1 for failure.
# If your hook had other checks, ensure they are also included and exit appropriately.
exit 0