# Monster Collection Scripts for Google Sheets

This repository contains a suite of Google Apps Scripts designed to enhance and automate the "The Ultimate Guide to Monster Collection" Google Sheet. These scripts provide robust features like two-way checkbox synchronization, dynamic hyperlink management, data cleanup utilities, and full spreadsheet backup and restore capabilities.

## Key Features

-   **Two-Way Checkbox Synchronization**: When you check or uncheck a monster on one sheet, the script automatically updates the status of that same monster across all other configured sheets. This is highly optimized for performance and works with multi-cell edits (e.g., toggling with the spacebar).
-   **Formula-Safe Operations**: The synchronization logic is designed to never overwrite cells that contain formulas, ensuring the integrity of your sheet's data and structure.
-   **Dynamic Hyperlink Updating**: A utility script can automatically scan a master "Collection" sheet and update hyperlinks to point to the exact cell of a monster on its respective location sheet (e.g., 'Elites'!B25).
-   **JSON Backup & Restore**: Export the entire spreadsheet state, including all values *and* formulas, to a JSON file in your Google Drive. This backup can be used to restore the sheet, correctly handling array formulas and their spilled results.
-   **Developer Utilities**: Includes helper scripts for data cleanup (e.g., `flattenCheckboxFormulas`) and automated API documentation generation.

## Project Structure

A brief overview of the key files in this project:

-   `autocheck-monsters.js`: The core script for checkbox synchronization. Contains the `onEdit` trigger and the main sync logic.
-   `update-links.js`: A standalone script to update hyperlinks in the `Collection` sheet.
-   `external-import-export.js`: Contains functions to export the sheet's content to a JSON file and import it back.
-   `utils.js`: A collection of shared helper functions.
-   `scripts/`: Contains Node.js scripts for development tasks, such as generating API documentation from JSDoc comments.
-   `docs/api/`: Contains the Markdown API documentation automatically generated by the scripts in the `scripts/` folder.

## Setup and Usage

### 1. Installation

#### Installation with Clasp (Recommended)
[Clasp](https://github.com/google/clasp) is a command-line tool that lets you manage your Google Apps Script projects locally.

1.  **Install Node.js**: If you don't have it, install [Node.js](https://nodejs.org/).
2.  **Install Clasp**: Open your terminal and install Clasp globally:
    ```sh
    npm install -g @google/clasp
    ```
3.  **Log in to Google**: Authorize Clasp to access your Google account:
    ```sh
    clasp login
    ```
4.  **Create an Apps Script Project**: Open the Google Sheet you want to use these scripts with, and go to **Extensions > Apps Script**. This creates a new, bound script project.
5.  **Get the Script ID**: In the Apps Script editor, go to **Project Settings** (the gear icon ⚙️) and copy the **Script ID**.
6.  **Update Configuration**: In this project's root directory, open the `.clasp.json` file and replace the value of `"scriptId"` with the ID you just copied.
7.  **Push Files**: In your terminal, from the project's root directory, run the following command to push all the local script files to your Apps Script project:
    ```sh
    clasp push
    ```

#### Manual Installation
1.  Open your Google Sheet.
2.  Go to **Extensions > Apps Script**.
3.  For each `.js` file in the root of this project (`autocheck-monsters.js`, `update-links.js`, etc.), create a corresponding script file in the Apps Script editor.
4.  Copy the contents of each local `.js` file and paste it into the corresponding file in the Apps Script editor.
5.  Save the project in the Apps Script editor.

### 2. Configuration

The checkbox synchronization script needs to know which sheets to monitor.

-   In `autocheck-monsters.js`, find the `CONFIG` object at the top of the file.
-   Add the names of all sheets you want to synchronize to the `syncSheetNames` array.

```javascript
const CONFIG = {
  syncSheetNames: [
    "Collection",
    "Elites",
    "Field",
    // Add other sheet names here
  ]
};
```

### 3. Running the Scripts

Most scripts are designed to be run manually from the Apps Script editor, except for the automatic `onEdit` trigger.

-   **Checkbox Sync (`onEdit` in `autocheck-monsters.js`)**: This runs automatically whenever you edit a checkbox in one of the configured sheets. No manual action is needed.
-   **Update Monster Links (`updateMonsterLinks` in `update-links.js`)**:
    1.  In the Apps Script editor, select the `updateMonsterLinks` function from the function dropdown menu.
    2.  Click **Run**.
-   **Export Data (`exportCellContentAndFormulasOptimized` in `external-import-export.js`)**:
    1.  Select the `exportCellContentAndFormulasOptimized` function.
    2.  Click **Run**. A JSON file will be saved to the root of your Google Drive.
-   **Import Data (`importCellContentAndFormulasOptimized` in `external-import-export.js`)**:
    1.  Select the `importCellContentAndFormulasOptimized` function.
    2.  Click **Run**. You will be prompted to enter the filename of the JSON backup.
-   **Flatten Checkbox Formulas (`flattenCheckboxFormulas` in `autocheck-monsters.js`)**:
    1.  This is a developer utility used to clean up checkbox columns that contain formulas.
    2.  Select the `flattenCheckboxFormulas` function and click **Run**.

## For Developers

This project uses `jsdoc-to-markdown` to automatically generate API documentation from JSDoc comments in the code.

### Prerequisites

-   [Node.js](https://nodejs.org/)

### Generating Documentation

1.  Install the required Node.js package:
    ```sh
    npm install
    ```
2.  Run the documentation generator script:
    ```sh
    node scripts/jsdoc-to-md.js
    ```
    This will scan the `.js` files, regenerate the documentation in `docs/api/` if any source files have changed, and update the API index file. This process is designed to be part of a pre-commit hook.

## API Reference

This section contains the auto-generated API documentation for the project. It is regenerated automatically by a pre-commit hook.

-   [autocheck-monsters](docs/api/autocheck-monsters.md)
-   [external-import-export](docs/api/external-import-export.md)
-   [update-links](docs/api/update-links.md)
-   [utils](docs/api/utils.md)